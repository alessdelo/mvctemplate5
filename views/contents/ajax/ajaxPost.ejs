<!-- <p class="lead">AJAX POST (with Express)</p> -->
 <hr class="my-4">

<script type="text/javascript" src="/static/js/extractors.js"></script>
<script type="text/javascript" src="/static/js/debugs.js"></script>
<script type="text/javascript" src="/static/js/randoms.js"></script>
<script type="text/javascript" src="/static/js/doms.js"></script>
<script type="text/javascript" src="/static/js/ajax.js"></script>


<% strMyVar = JSON.stringify(myVar, null, 4); %>
<!-- <%= strMyVar %> -->
<% var passEjs = strMyVar; %>
<% var passEjsObj = myVar; %>

<script>
var getPassEjs = <%- passEjs %>;
</script>

<script>
  // alert("passEjs = " + passEjs);
  // How to extract values ftom getPassEjs
  // alert("getPassEjs = " + getPassEjs);
  // alert(getPassEjs[0]);
  // alert(getPassEjs[0]["puppyTestInfos"]);
</script>


<br><br>
<hr class="my-4">

<h4>1) Verifies that JQuery works...</h4>


<script>
$(document).ready(function(){
 $("#msgid").html("This is Hello World by JQuery!!!!!");
});
</script>

This is Hello World by HTML:

<br><br>

<div id="msgid">waiting for message ...</div>

<br><br>
<hr class="my-4">

<h4>2) BASIC AJAX POST REQUEST/RESPONSE</h4>
<p>- simple form with input text fields</p>
<p>- input text fields are dynamically defined with the function by the parameter "formData"</p>
<p>- the parameter "formData" gives the list of the form fields</p>
<p>- on button click sends POST data to a controller file</p>
<p>- the controller file elaborate and re-sends the data recieved via POST</p>


<script>

// https://grokonez.com/node-js/integrate-nodejs-express-jquery-ajax-post-get-bootstrap-view

function ajaxForm(theUrl, formID, formData, customfunction) {

	$(document).ready(function() {

	  // SUBMIT FORM
	    $("#" + formID).submit(function(event) {
	    // Prevent the form from submitting via the browser.
	    event.preventDefault();
	    ajaxPost();
	  });


	    function ajaxPost(){
	    
		let extractedData = {};
	    	const keys = Object.keys(formData)
		let i = 0
		for (const key of keys) {
  					extractedData[key] = $("#" + key).val();
					}		

	      // DO POST
	      $.ajax({
	      type : "POST",
	      contentType : "application/json",
	      url : theUrl,
	      data : JSON.stringify(extractedData),
	      dataType : 'json',
	      success : function(data) {
				// alert(JSON.stringify(data));
				customfunction(data);
	      },
	      error : function(e) {
		alert("Error!");
		console.log("ERROR: ", e);
	      }
	    });

	      // Reset FormData after Posting
	      resetData(formData);

	    }
	
	    function resetData(theFormData){
	
	    	const keys = Object.keys(theFormData)
		for (const key of keys) {
  					$("#" + key).val("");
					}
	    }

	})

} // end ajaxForm


// FORM DATA
var theFormData = {
		firstname : "input",
		lastname :  "input",
		city : "input"
	      	};
		
function theCustomFunction(jsonData) {
					alert("data are: " + JSON.stringify(jsonData));
				     }

ajaxForm("/ajax/ajaxPostResp", "testForm", theFormData, theCustomFunction);

</script>

 <!--Card content-->
    <div class="card-body px-lg-5 pt-0">
    
	 <form id="testForm" class="text-center" style="color: #757575;">
	    <h4>Sends the input data to the controller...</h4>
	    <div class="form-row">
                <div class="col">
                    <!-- generic input text data -->
                    <div class="md-form">
		    	<label for="firstname">FirstName:</label>
			<input type="text" name="firstname"  id="firstname" class="form-control" placeholder="Enter FirstName"/>
                    </div>
                </div>
            </div>
	    
	    <div class="form-row">
                <div class="col">
                    <!-- generic input text data -->
                    <div class="md-form">
		    	<label for="lastname">LastName:</label>
			<input type="text" name="lastname"  id="lastname" class="form-control" placeholder="Enter LastName"/>
                    </div>
                </div>
            </div>
	    
	    <div class="form-row">
                <div class="col">
                    <!-- generic input text data -->
                    <div class="md-form">
		    	<label for="lastname">City:</label>
			<input type="text" name="city"  id="city" class="form-control" placeholder="Enter City"/>
                    </div>
                </div>
            </div>
	    
	      <button type="submit" class="btn btn-outline-info btn-rounded btn-block my-4 waves-effect z-depth-0">Submit</button>
	      
	 </form>	 
     </div>
 <!--End of Card content-->

<br><br>
<hr class="my-4">

<h4>3) AJAX QUERY TO MONGO FROM A FORM SELECT</h4>
<p>- form with a select menu field</p>
<p>- uses the same function of the input form</p>
<p>- infact the jquery id selector "#" and the val() property are valid fotr the select field as the same for the input field</p>
<p>- input text fields are dynamically defined with the function by the parameter "formData"</p>
<p>- on button click sends POST data to a controller file</p>
<p>- the controller file quaries the Mongo DB
<p>- the form data recieved by the controller (req.body) are filtered with a regex</p>
<p>- the filtered data are returned - asynchronously - to the html file</p>

<script>

// FORM DATA
var selectFormData = {
		selectTest : "select"
	      	};

function anotherCustomFunction(jsonData) {
					alert("data are: " + JSON.stringify(jsonData));
				     }

ajaxForm("/ajax/ajaxPostMongo", "selectForm", selectFormData, anotherCustomFunction);

    
</script>

<!--Card content-->
    <div class="card-body px-lg-5 pt-0">
    
	 <form id="selectForm" class="text-center" style="color: #757575;">
	    <h4>Returns a list of records that start with the chosen letter...</h4>
	    <div class="form-row">
                <div class="col">
                    <!-- generic input text data -->
                    <div class="md-form">
		    	    <label for="selectTest">Choose a letter:</label>
			    <select name="selectTest" id="selectTest" class="form-control mb-4">
			      <option disabled selected value="1">Select an option..</option>
			      <option value="a">a</option>
			      <option value="b">b</option>
			      <option value="c">c</option>
			      <option value="d">d</option>
			      <option value="G">G</option>
			      <option value="g">g</option>
			      <option value="J">J</option>
			      <option value="j">j</option>
			    </select>
                    </div>
                </div>
            </div>
	    
	      <button type="submit" class="btn btn-outline-info btn-rounded btn-block my-4 waves-effect z-depth-0">Submit</button>
	      
	 </form>	 
     </div>
 <!--End of Card content-->

<br><br>
<hr class="my-4">






